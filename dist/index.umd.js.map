{"version":3,"file":"index.umd.js","sources":["../src/assert.ts","../src/glutil.ts","../src/array.ts","../src/vertex-buffer.ts","../src/element-buffer.ts","../src/vertex-array.ts","../src/render-pass.ts","../src/texture.ts","../src/framebuffer.ts"],"sourcesContent":["export function isTrue(condition: boolean, message?: string): void {\n    if (!condition) { throw new Error(message || \"Assertion failed\"); }\n}\n\nexport function never(x: never, message?: string): never {\n    throw new Error(message || \"Unexpected object: \" + x);\n}\n","import * as assert from \"./assert\";\n\n/*\n███████╗██╗  ██╗ █████╗ ██████╗ ███████╗██████╗\n██╔════╝██║  ██║██╔══██╗██╔══██╗██╔════╝██╔══██╗\n███████╗███████║███████║██║  ██║█████╗  ██████╔╝\n╚════██║██╔══██║██╔══██║██║  ██║██╔══╝  ██╔══██╗\n███████║██║  ██║██║  ██║██████╔╝███████╗██║  ██║\n╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝ ╚══════╝╚═╝  ╚═╝\n*/\n\nexport function createProgram(\n    gl: WebGL2RenderingContext,\n    vertex: WebGLShader,\n    fragment: WebGLShader,\n): WebGLProgram {\n    const program = gl.createProgram();\n    if (!program) { throw new Error(\"Could not create Program\"); }\n\n    gl.attachShader(program, vertex);\n    gl.attachShader(program, fragment);\n\n    gl.linkProgram(program);\n\n    if (gl.getProgramParameter(program, gl.LINK_STATUS)) { return program; }\n\n    const msg = gl.getProgramInfoLog(program);\n    gl.deleteProgram(program);\n    throw new Error(`Could not link shader program: ${msg}`);\n}\n\nexport function createShader(\n    gl: WebGL2RenderingContext,\n    type: number,\n    source: string,\n): WebGLShader {\n    const shader = gl.createShader(type);\n    if (!shader) { throw new Error(\"Could not create Shader\"); }\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (gl.getShaderParameter(shader, gl.COMPILE_STATUS)) { return shader; }\n\n    const msg = gl.getShaderInfoLog(shader);\n    gl.deleteShader(shader);\n    const prettySource = source\n        .split(\"\\n\")\n        .map((l, i) => `${i + 1}: ${l}`)\n        .join(\"\\n\");\n    throw new Error(`Could not compile shader:\\n${msg}\\n${prettySource}`);\n}\n\n/*\n██████╗ ██╗   ██╗███████╗███████╗███████╗██████╗\n██╔══██╗██║   ██║██╔════╝██╔════╝██╔════╝██╔══██╗\n██████╔╝██║   ██║█████╗  █████╗  █████╗  ██████╔╝\n██╔══██╗██║   ██║██╔══╝  ██╔══╝  ██╔══╝  ██╔══██╗\n██████╔╝╚██████╔╝██║     ██║     ███████╗██║  ██║\n╚═════╝  ╚═════╝ ╚═╝     ╚═╝     ╚══════╝╚═╝  ╚═╝\n*/\n\nexport function createArrayBuffer(\n    gl: WebGL2RenderingContext,\n    values: ArrayBuffer | ArrayBufferView,\n): WebGLBuffer {\n    const buffer = gl.createBuffer();\n    if (!buffer) { throw new Error(\"Could not create buffer\"); }\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(\n        gl.ARRAY_BUFFER,\n        Array.isArray(values)\n            ? new Float32Array(values)\n            : values,\n        gl.STATIC_DRAW,\n    );\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    return buffer;\n}\n\nexport function createElementArrayBuffer(\n    gl: WebGL2RenderingContext,\n    elements: Uint32Array,\n): WebGLBuffer {\n    const buffer = gl.createBuffer();\n    if (!buffer) { throw new Error(\"Could not create buffer\"); }\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n    gl.bufferData(\n        gl.ELEMENT_ARRAY_BUFFER,\n        Array.isArray(elements)\n            ? new Uint32Array(elements)\n            : elements,\n        gl.STATIC_DRAW,\n    );\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    return buffer;\n}\n\n/*\n██╗   ██╗███████╗██████╗ ████████╗███████╗██╗  ██╗\n██║   ██║██╔════╝██╔══██╗╚══██╔══╝██╔════╝╚██╗██╔╝\n██║   ██║█████╗  ██████╔╝   ██║   █████╗   ╚███╔╝\n╚██╗ ██╔╝██╔══╝  ██╔══██╗   ██║   ██╔══╝   ██╔██╗\n ╚████╔╝ ███████╗██║  ██║   ██║   ███████╗██╔╝ ██╗\n  ╚═══╝  ╚══════╝╚═╝  ╚═╝   ╚═╝   ╚══════╝╚═╝  ╚═╝\n\n █████╗ ██████╗ ██████╗  █████╗ ██╗   ██╗\n██╔══██╗██╔══██╗██╔══██╗██╔══██╗╚██╗ ██╔╝\n███████║██████╔╝██████╔╝███████║ ╚████╔╝\n██╔══██║██╔══██╗██╔══██╗██╔══██║  ╚██╔╝\n██║  ██║██║  ██║██║  ██║██║  ██║   ██║\n╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝   ╚═╝\n*/\n\nexport const enum AttribType {\n    Pointer = 0,\n    IPointer = 1,\n}\n\nexport function createVertexArray(\n    gl: WebGL2RenderingContext,\n    buffers: {\n        type: AttribType,\n        buffer: WebGLBuffer;\n        bufferType: number,\n        size: number;\n        location: number,\n        normalized?: boolean,\n        divisor?: number,\n    }[],\n    elementBuffer: WebGLBuffer,\n): WebGLVertexArrayObject {\n    const vao = gl.createVertexArray();\n    if (!vao) { throw new Error(\"Could not create Vertex Array Object\"); }\n\n    gl.bindVertexArray(vao);\n    buffers.forEach(({\n        type,\n        buffer,\n        bufferType,\n        size,\n        location,\n        normalized = false,\n        divisor,\n    }) => {\n        // Enable sending attribute arrays for location\n        gl.enableVertexAttribArray(location);\n\n        // Send buffer\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        switch (type) {\n            case AttribType.Pointer:\n                gl.vertexAttribPointer(location, size, bufferType, normalized, 0, 0);\n                break;\n            case AttribType.IPointer:\n                gl.vertexAttribIPointer(location, size, bufferType, 0, 0);\n                break;\n            default: assert.never(type);\n        }\n        if (divisor) { gl.vertexAttribDivisor(location, divisor); }\n    });\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\n\n    gl.bindVertexArray(null);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n    return vao;\n}\n\n/*\n████████╗███████╗██╗  ██╗████████╗██╗   ██╗██████╗ ███████╗\n╚══██╔══╝██╔════╝╚██╗██╔╝╚══██╔══╝██║   ██║██╔══██╗██╔════╝\n   ██║   █████╗   ╚███╔╝    ██║   ██║   ██║██████╔╝█████╗\n   ██║   ██╔══╝   ██╔██╗    ██║   ██║   ██║██╔══██╗██╔══╝\n   ██║   ███████╗██╔╝ ██╗   ██║   ╚██████╔╝██║  ██║███████╗\n   ╚═╝   ╚══════╝╚═╝  ╚═╝   ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚══════╝\n*/\n\nexport function createTexture(\n    gl: WebGL2RenderingContext,\n    data: ArrayBufferView | null,\n    width: number,\n    height: number,\n    internalFormat: number,\n    format: number,\n    type: number,\n    wrapS: number,\n    wrapT: number,\n    min: number,\n    mag: number,\n    mipmap: boolean,\n): WebGLTexture {\n    const texture = gl.createTexture();\n    if (!texture) { throw new Error(\"Could not create texture\"); }\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    gl.texStorage2D(gl.TEXTURE_2D, 1, internalFormat, width, height);\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, width, height, format, type, data);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapS);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapT);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, min);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, mag);\n\n    if (mipmap) { gl.generateMipmap(gl.TEXTURE_2D); }\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    return texture;\n}\n\n/*\n███████╗██████╗  █████╗ ███╗   ███╗███████╗\n██╔════╝██╔══██╗██╔══██╗████╗ ████║██╔════╝\n█████╗  ██████╔╝███████║██╔████╔██║█████╗\n██╔══╝  ██╔══██╗██╔══██║██║╚██╔╝██║██╔══╝\n██║     ██║  ██║██║  ██║██║ ╚═╝ ██║███████╗\n╚═╝     ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝\n\n██████╗ ██╗   ██╗███████╗███████╗███████╗██████╗\n██╔══██╗██║   ██║██╔════╝██╔════╝██╔════╝██╔══██╗\n██████╔╝██║   ██║█████╗  █████╗  █████╗  ██████╔╝\n██╔══██╗██║   ██║██╔══╝  ██╔══╝  ██╔══╝  ██╔══██╗\n██████╔╝╚██████╔╝██║     ██║     ███████╗██║  ██║\n╚═════╝  ╚═════╝ ╚═╝     ╚═╝     ╚══════╝╚═╝  ╚═╝\n*/\n\nexport function createFramebuffer(\n    gl: WebGL2RenderingContext,\n    textures: WebGLTexture[],\n): WebGLFramebuffer {\n    const fbo = gl.createFramebuffer();\n    if (!fbo) { throw new Error(\"Could not create framebuffer\"); }\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    textures.forEach((texture, i) => {\n        gl.framebufferTexture2D(\n            gl.FRAMEBUFFER,\n            gl.COLOR_ATTACHMENT0 + i,\n            gl.TEXTURE_2D,\n            texture,\n            0,\n        );\n    });\n\n    if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) === gl.FRAMEBUFFER_COMPLETE) {\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        return fbo;\n    }\n\n    gl.deleteFramebuffer(fbo);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    throw new Error(\"Framebuffer not complete\");\n}\n","/**\n * Chacks whether  array is at least 2d, mostly useful because of return type\n * predicate.\n */\nexport function is2DArray(array: any[] | any[][]): array is any[][] {\n    return !!array.length || Array.isArray(array[0]);\n}\n\nexport interface Raveled<T> {\n    data: T[];\n    shape: [number, number];\n}\n\n/**\n * Flatten 2d array and compute its former shape.\n * eg.\n * ravel([\n *      [1, 2, 3],\n *      [4, 5, 6],\n * ])\n * produces {\n *      data: [1, 2, 3, 4, 5, 6],\n *      shape: [2, 3],\n * }\n */\nexport function ravel<T>(unraveled: T[][]): Raveled<T> {\n    const outerShape = unraveled.length;\n    const innerShape = outerShape ? unraveled[0].length : 0;\n    const raveled: T[] = new Array<T>(innerShape * outerShape);\n    unraveled.forEach((inner, i) => {\n        inner.forEach((elem, j) => {\n            raveled[innerShape * i + j] = elem;\n        });\n    });\n    return { data: raveled, shape: [outerShape, innerShape] };\n}\n","import * as assert from \"./assert\";\nimport * as glutil from \"./glutil\";\n\nexport type VertexBufferType = VertexBufferProps[\"type\"];\n\nexport type VertexBufferProps =\n    | VertexBufferInt8Props\n    | VertexBufferInt16Props\n    | VertexBufferInt32Props\n    | VertexBufferUint8Props\n    | VertexBufferUint16Props\n    | VertexBufferUint32Props\n    | VertexBufferFloat32Props\n    ;\n\nexport interface VertexBufferInt8Props {\n    type: \"i8\";\n    data: number[] | Int8Array;\n}\n\nexport interface VertexBufferInt16Props {\n    type: \"i16\";\n    data: number[] | Int16Array;\n}\n\nexport interface VertexBufferInt32Props {\n    type: \"i32\";\n    data: number[] | Int32Array;\n}\n\nexport interface VertexBufferUint8Props {\n    type: \"u8\";\n    data: number[] | Uint8Array | Uint8ClampedArray;\n}\n\nexport interface VertexBufferUint16Props {\n    type: \"u16\";\n    data: number[] | Uint16Array;\n}\n\nexport interface VertexBufferUint32Props {\n    type: \"u32\";\n    data: number[] | Uint32Array;\n}\n\nexport interface VertexBufferFloat32Props {\n    type: \"f32\";\n    data: number[] | Float32Array;\n}\n\nexport class VertexBuffer<T extends VertexBufferType = VertexBufferType> {\n\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferInt8Props,\n    ): VertexBuffer<\"i8\">;\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferInt16Props,\n    ): VertexBuffer<\"i16\">;\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferInt32Props,\n    ): VertexBuffer<\"i32\">;\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferUint8Props,\n    ): VertexBuffer<\"u8\">;\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferUint16Props,\n    ): VertexBuffer<\"u16\">;\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferUint32Props,\n    ): VertexBuffer<\"u32\">;\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferFloat32Props,\n    ): VertexBuffer<\"f32\">;\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: VertexBufferProps,\n    ): VertexBuffer<VertexBufferProps[\"type\"]> {\n        switch (props.type) {\n            case \"i8\": return VertexBuffer.fromInt8Array(gl, props.data);\n            case \"i16\": return VertexBuffer.fromInt16Array(gl, props.data);\n            case \"i32\": return VertexBuffer.fromInt32Array(gl, props.data);\n            case \"u8\": return VertexBuffer.fromUint8Array(gl, props.data);\n            case \"u16\": return VertexBuffer.fromUint16Array(gl, props.data);\n            case \"u32\": return VertexBuffer.fromUint32Array(gl, props.data);\n            case \"f32\": return VertexBuffer.fromFloat32Array(gl, props.data);\n            default: return assert.never(props);\n        }\n    }\n\n    static fromInt8Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Int8Array,\n    ): VertexBuffer<\"i8\"> {\n        return new VertexBuffer(\n            gl,\n            \"i8\",\n            gl.BYTE,\n            data instanceof Int8Array ? data : new Int8Array(data),\n        );\n    }\n\n    static fromInt16Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Int16Array,\n    ): VertexBuffer<\"i16\"> {\n        return new VertexBuffer(\n            gl,\n            \"i16\",\n            gl.SHORT,\n            data instanceof Int16Array ? data : new Int16Array(data),\n        );\n    }\n\n    static fromInt32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Int32Array,\n    ): VertexBuffer<\"i32\"> {\n        return new VertexBuffer(\n            gl,\n            \"i32\",\n            gl.INT,\n            data instanceof Int32Array ? data : new Int32Array(data),\n        );\n    }\n\n    static fromUint8Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Uint8Array | Uint8ClampedArray,\n    ): VertexBuffer<\"u8\"> {\n        return new VertexBuffer(\n            gl,\n            \"u8\",\n            gl.UNSIGNED_BYTE,\n            // Note: we also have to convert Uint8ClampedArray to Uint8Array\n            // because of webgl bug\n            // https://github.com/KhronosGroup/WebGL/issues/1533\n            data instanceof Uint8Array ? data : new Uint8Array(data),\n        );\n    }\n\n    static fromUint16Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Uint16Array,\n    ): VertexBuffer<\"u16\"> {\n        return new VertexBuffer(\n            gl,\n            \"u16\",\n            gl.UNSIGNED_SHORT,\n            data instanceof Uint16Array ? data : new Uint16Array(data),\n        );\n    }\n\n    static fromUint32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Uint32Array,\n    ): VertexBuffer<\"u32\"> {\n        return new VertexBuffer(\n            gl,\n            \"u32\",\n            gl.UNSIGNED_INT,\n            data instanceof Uint32Array ? data : new Uint32Array(data),\n        );\n    }\n\n    static fromFloat32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Float32Array,\n    ): VertexBuffer<\"f32\"> {\n        return new VertexBuffer(\n            gl,\n            \"f32\",\n            gl.FLOAT,\n            data instanceof Float32Array ? data : new Float32Array(data),\n        );\n    }\n\n    readonly gl: WebGL2RenderingContext;\n    readonly type: T;\n    readonly glType: number;\n    readonly glBuffer: WebGLBuffer;\n\n    private constructor(\n        gl: WebGL2RenderingContext,\n        type: T,\n        glType: number,\n        data: ArrayBuffer | ArrayBufferView,\n    ) {\n        this.gl = gl;\n        this.type = type;\n        this.glType = glType;\n        this.glBuffer = glutil.createArrayBuffer(gl, data);\n    }\n}\n","import * as array from \"./array\";\nimport * as glutil from \"./glutil\";\n\nexport type ElementBufferProps =\n    | ElementBufferArrayProps\n    | ElementBufferObjectProps\n    ;\n\nexport interface ElementBufferObjectProps {\n    primitive: ElementPrimitive;\n    data: number[] | Uint32Array;\n}\n\nexport type ElementBufferArrayProps = [number, number, number][];\nexport type ElementPrimitive = \"triangles\";\n\nexport class ElementBuffer {\n\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        props: ElementBufferProps,\n    ): ElementBuffer {\n        if (Array.isArray(props)) {\n            return ElementBuffer.fromArray(gl, props);\n        }\n        return ElementBuffer.fromUint32Array(gl, props.data, props.primitive);\n    }\n\n    static fromArray(\n        gl: WebGL2RenderingContext,\n        arr: ElementBufferArrayProps,\n    ): ElementBuffer {\n        const data = array.ravel(arr).data;\n        return new ElementBuffer(gl, new Uint32Array(data), \"triangles\");\n    }\n\n    static fromUint32Array(\n        gl: WebGL2RenderingContext,\n        buffer: number[] | Uint32Array,\n        primitive: ElementPrimitive,\n    ): ElementBuffer {\n        return new ElementBuffer(\n            gl,\n            Array.isArray(buffer) ? new Uint32Array(buffer) : buffer,\n            primitive,\n        );\n    }\n\n    readonly glBuffer: WebGLBuffer;\n    readonly count: number;\n    readonly primitive: ElementPrimitive;\n\n    private constructor(\n        gl: WebGL2RenderingContext,\n        buffer: Uint32Array,\n        primitive: ElementPrimitive,\n    ) {\n        this.glBuffer = glutil.createElementArrayBuffer(gl, buffer);\n        this.count = buffer.length;\n        this.primitive = primitive;\n    }\n}\n","import * as assert from \"./assert\";\nimport * as array from \"./array\";\nimport * as glutil from \"./glutil\";\nimport {\n    VertexBuffer,\n    VertexBufferProps,\n    VertexBufferInt8Props,\n    VertexBufferInt16Props,\n    VertexBufferInt32Props,\n    VertexBufferUint8Props,\n    VertexBufferUint16Props,\n    VertexBufferUint32Props,\n} from \"./vertex-buffer\";\nimport {\n    ElementBuffer,\n    ElementBufferProps,\n    ElementPrimitive,\n} from \"./element-buffer\";\n\nconst INT_PATTERN = /^0|[1-9]\\d*$/;\n\nexport type AttributeType =\n    | \"pointer\"\n    | \"ipointer\"\n    ;\n\nexport type Attribute =\n    | AttributeArray\n    | AttributeObject\n    ;\n\nexport type AttributeArray =\n    | number[]\n    | [number, number][]\n    | [number, number, number][]\n    | [number, number, number, number][]\n    ;\n\nexport type AttributeObject =\n    | AttributePointer\n    | AttributeIPointer\n    ;\n\nexport interface AttributePointer {\n    type: \"pointer\";\n    value: VertexBuffer | PointerValue;\n    count: number;\n    size: number;\n    normalized?: boolean;\n    divisor?: number;\n}\n\nexport interface AttributeIPointer {\n    type: \"ipointer\";\n    value: VertexBuffer<IPointerValue[\"type\"]> | IPointerValue;\n    count: number;\n    size: number;\n    divisor?: number;\n}\n\nexport type PointerValue = VertexBufferProps;\n\nexport type IPointerValue =\n    | VertexBufferInt8Props\n    | VertexBufferInt16Props\n    | VertexBufferInt32Props\n    | VertexBufferUint8Props\n    | VertexBufferUint16Props\n    | VertexBufferUint32Props\n    ;\n\nexport interface VertexArrayProps {\n    attributes: {\n        [name: string]: Attribute;\n        [location: number]: Attribute;\n    };\n    elements: ElementBuffer | ElementBufferProps;\n}\n\nexport class VertexArray {\n\n    static fromProps(\n        gl: WebGL2RenderingContext,\n        { attributes, elements }: VertexArrayProps,\n    ): VertexArray {\n\n        // Setup attributes\n\n        const attribs: AttributeInfo[] = [];\n        const attribLocations: number[] = [];\n        Object.entries(attributes).forEach(([locationStr, definition]) => {\n            if (!INT_PATTERN.test(locationStr)) {\n                throw new Error(\n                    \"Location is not a number. Use RenderPass#createVertexArray to resolve names.\",\n                );\n            }\n            const location = parseInt(locationStr, 10);\n            attribLocations.push(location);\n            attribs.push(AttributeInfo.create(gl, definition));\n        });\n\n        // Setup elements\n\n        const elems = elements instanceof ElementBuffer\n            ? elements\n            : ElementBuffer.fromProps(gl, elements);\n\n        // Create vertex array\n\n        const vao = glutil.createVertexArray(\n            gl,\n            attribs.map((attrib, i) => ({\n                type: attrib.type === \"ipointer\"\n                    ? glutil.AttribType.IPointer\n                    : glutil.AttribType.Pointer,\n                buffer: attrib.buffer.glBuffer,\n                bufferType: attrib.buffer.glType,\n                size: attrib.size,\n                location: attribLocations[i],\n                normalized: attrib.normalized,\n                divisor: attrib.divisor,\n            })),\n            elems.glBuffer,\n        );\n\n        // Compute max safe instance count\n\n        const instancedBuffers = attribs\n            .filter(buffer => !!buffer.divisor);\n\n        const instanceCount = instancedBuffers.length\n            ? instancedBuffers\n                .map(b => b.count * b.divisor)\n                .reduce((min, curr) => Math.min(min, curr))\n            : 0;\n\n        // Create VAO\n\n        return new VertexArray(\n            vao,\n            elems.count,\n            elems.primitive,\n            instanceCount,\n        );\n    }\n\n    readonly glVertexArrayObject: WebGLVertexArrayObject;\n\n    readonly count: number;\n    readonly primitive: ElementPrimitive;\n    readonly instanceCount: number;\n\n    private constructor(\n        vao: WebGLVertexArrayObject,\n        count: number,\n        primitive: ElementPrimitive,\n        instanceCount: number,\n    ) {\n        this.glVertexArrayObject = vao;\n        this.count = count;\n        this.primitive = primitive;\n        this.instanceCount = instanceCount;\n    }\n}\n\n// TODO: this could use some further refactoring. Currently its just former\n// public API made private.\nclass AttributeInfo {\n\n    static create(\n        gl: WebGL2RenderingContext,\n        props: Attribute,\n    ): AttributeInfo {\n        if (Array.isArray(props)) {\n            if (array.is2DArray(props)) {\n                const r = array.ravel(props);\n                return new AttributeInfo(\n                    \"pointer\",\n                    VertexBuffer.fromFloat32Array(gl, r.data),\n                    r.shape[0],\n                    r.shape[1],\n                    false,\n                    0,\n                );\n            }\n            return new AttributeInfo(\n                \"pointer\",\n                VertexBuffer.fromFloat32Array(gl, props),\n                props.length,\n                1,\n                false,\n                0,\n            );\n        }\n\n        switch (props.type) {\n            case \"pointer\": return new AttributeInfo(\n                props.type,\n                props.value instanceof VertexBuffer\n                    ? props.value\n                    // Note: typescript is not smart enough to infer what we know\n                    : VertexBuffer.fromProps(gl, props.value as any),\n                props.count,\n                props.size,\n                props.normalized || false,\n                props.divisor || 0,\n            );\n            case \"ipointer\": return new AttributeInfo(\n                props.type,\n                props.value instanceof VertexBuffer\n                    ? props.value\n                    // Note: typescript is not smart enough to infer what we know\n                    : VertexBuffer.fromProps(gl, props.value as any),\n                props.count,\n                props.size,\n                false,\n                props.divisor || 0,\n            );\n            default: return assert.never(props);\n        }\n\n    }\n\n    readonly type: AttributeType;\n    readonly buffer: VertexBuffer;\n    readonly count: number;\n    readonly size: number;\n    readonly normalized: boolean;\n    readonly divisor: number;\n\n    private constructor(\n        type: AttributeType,\n        buffer: VertexBuffer,\n        count: number,\n        size: number,\n        normalized: boolean,\n        divisor: number,\n    ) {\n        this.type = type;\n        this.buffer = buffer;\n        this.count = count;\n        this.size = size;\n        this.normalized = normalized;\n        this.divisor = divisor;\n    }\n}\n","import * as assert from \"./assert\";\nimport * as glutil from \"./glutil\";\nimport { VertexArray, VertexArrayProps } from \"./vertex-array\";\nimport { Texture } from \"./texture\";\nimport { Framebuffer } from \"./framebuffer\";\n\nconst INT_PATTERN = /^0|[1-9]\\d*$/;\nconst UNKNOWN_ATTRIB_LOCATION = -1;\n\nexport interface RenderPassProps<P> {\n    vert: string;\n    frag: string;\n    uniforms?: { [key: string]: Uniform<P> };\n}\n\nexport class RenderPass<P = void> {\n\n    static fromProps<P = void>(\n        gl: WebGL2RenderingContext,\n        { vert, frag, uniforms = {} }: RenderPassProps<P>,\n    ): RenderPass<P> {\n        const vertShader = glutil.createShader(gl, gl.VERTEX_SHADER, vert);\n        const fragShader = glutil.createShader(gl, gl.FRAGMENT_SHADER, frag);\n        const program = glutil.createProgram(gl, vertShader, fragShader);\n\n        gl.deleteShader(vertShader);\n        gl.deleteShader(fragShader);\n\n        const uniformInfo = Object.entries(uniforms)\n            .map(([identifier, uniform]) => {\n                const location = gl.getUniformLocation(program, identifier);\n                if (!location) {\n                    throw new Error(`No location for uniform: ${identifier}`);\n                }\n                return new UniformInfo(identifier, location, uniform);\n            });\n        return new RenderPass(gl, program, uniformInfo);\n    }\n\n\n    private gl: WebGL2RenderingContext;\n    private glProgram: WebGLProgram;\n    private uniformInfo: UniformInfo<P>[];\n\n    private constructor(\n        gl: WebGL2RenderingContext,\n        program: WebGLProgram,\n        uniformInfo: UniformInfo<P>[],\n    ) {\n        this.gl = gl;\n        this.glProgram = program;\n        this.uniformInfo = uniformInfo;\n    }\n\n    render(\n        vao: VertexArray,\n        props: P,\n        count?: number,\n        instanceCount?: number,\n    ): void {\n        const gl = this.gl;\n        const elemCount = typeof count === \"undefined\"\n            ? vao.count\n            : Math.min(vao.count, count);\n        const instCount = typeof instanceCount === \"undefined\"\n            ? vao.instanceCount\n            : Math.min(vao.instanceCount, instanceCount);\n\n        gl.useProgram(this.glProgram);\n        this.updateUniforms(props);\n        gl.bindVertexArray(vao.glVertexArrayObject);\n\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n        this.draw(elemCount, instCount);\n\n        gl.bindVertexArray(null);\n    }\n\n    renderToFramebuffer(\n        vao: VertexArray,\n        props: P,\n        framebuffer: Framebuffer,\n        count?: number,\n        instanceCount?: number,\n    ): void {\n        const gl = this.gl;\n        const elemCount = typeof count === \"undefined\"\n            ? vao.count\n            : Math.min(vao.count, count);\n        const instCount = typeof instanceCount === \"undefined\"\n            ? vao.instanceCount\n            : Math.min(vao.instanceCount, instanceCount);\n\n        gl.useProgram(this.glProgram);\n        this.updateUniforms(props);\n        gl.bindVertexArray(vao.glVertexArrayObject);\n\n        framebuffer.bind();\n        gl.drawBuffers(framebuffer.colorAttachments);\n\n        gl.viewport(0, 0, framebuffer.width, framebuffer.height);\n        this.draw(elemCount, instCount);\n\n        framebuffer.unbind();\n\n        gl.bindVertexArray(null);\n    }\n\n    createVertexArray({ attributes, elements }: VertexArrayProps): VertexArray {\n        type Attributes = VertexArrayProps[\"attributes\"];\n        const { gl, glProgram } = this;\n        const locatedAttributes = Object.entries(attributes)\n            .reduce<Attributes>((accum, [identifier, definition]) => {\n                if (INT_PATTERN.test(identifier)) {\n                    accum[identifier] = definition;\n                } else {\n                    const location = gl.getAttribLocation(glProgram, identifier);\n                    if (location === UNKNOWN_ATTRIB_LOCATION) {\n                        throw new Error(`No location for attrib: ${identifier}`);\n                    }\n                    accum[location] = definition;\n                }\n                return accum;\n            }, {});\n        return VertexArray.fromProps(gl, {\n            attributes: locatedAttributes,\n            elements,\n        });\n    }\n\n    private draw(\n        elemCount: number,\n        instCount: number,\n    ): void {\n        const gl = this.gl;\n        if (instCount) {\n            gl.drawElementsInstanced(\n                gl.TRIANGLES,\n                elemCount,\n                gl.UNSIGNED_INT,\n                0,\n                instCount,\n            );\n        } else {\n            gl.drawElements(gl.TRIANGLES, elemCount, gl.UNSIGNED_INT, 0);\n        }\n    }\n\n    private updateUniforms(props: P): void {\n        const gl = this.gl;\n\n        let textureUnitOffset = 0;\n\n        this.uniformInfo.forEach(({\n            identifier: ident,\n            location: loc,\n            definition: def,\n        }) => {\n            switch (def.type) {\n                case \"1f\":\n                    gl.uniform1f(loc, access(props, def.value));\n                    break;\n                case \"1fv\":\n                    gl.uniform1fv(loc, access(props, def.value));\n                    break;\n                case \"1i\":\n                    gl.uniform1i(loc, access(props, def.value));\n                    break;\n                case \"1iv\":\n                    gl.uniform1iv(loc, access(props, def.value));\n                    break;\n                case \"1ui\":\n                    gl.uniform1ui(loc, access(props, def.value));\n                    break;\n                case \"1uiv\":\n                    gl.uniform1uiv(loc, access(props, def.value));\n                    break;\n                case \"2f\": {\n                    const [x, y] = access(props, def.value);\n                    gl.uniform2f(loc, x, y);\n                    break;\n                }\n                case \"2fv\":\n                    gl.uniform2fv(loc, access(props, def.value));\n                    break;\n                case \"2i\": {\n                    const [x, y] = access(props, def.value);\n                    gl.uniform2i(loc, x, y);\n                    break;\n                }\n                case \"2iv\":\n                    gl.uniform2iv(loc, access(props, def.value));\n                    break;\n                case \"2ui\": {\n                    const [x, y] = access(props, def.value);\n                    gl.uniform2ui(loc, x, y);\n                    break;\n                }\n                case \"2uiv\":\n                    gl.uniform2uiv(loc, access(props, def.value));\n                    break;\n                case \"3f\": {\n                    const [x, y, z] = access(props, def.value);\n                    gl.uniform3f(loc, x, y, z);\n                    break;\n                }\n                case \"3fv\":\n                    gl.uniform3fv(loc, access(props, def.value));\n                    break;\n                case \"3i\": {\n                    const [x, y, z] = access(props, def.value);\n                    gl.uniform3i(loc, x, y, z);\n                    break;\n                }\n                case \"3iv\":\n                    gl.uniform3iv(loc, access(props, def.value));\n                    break;\n                case \"3ui\": {\n                    const [x, y, z] = access(props, def.value);\n                    gl.uniform3ui(loc, x, y, z);\n                    break;\n                }\n                case \"3uiv\":\n                    gl.uniform3uiv(loc, access(props, def.value));\n                    break;\n                case \"4f\": {\n                    const [x, y, z, w] = access(props, def.value);\n                    gl.uniform4f(loc, x, y, z, w);\n                    break;\n                }\n                case \"4fv\":\n                    gl.uniform4fv(loc, access(props, def.value));\n                    break;\n                case \"4i\": {\n                    const [x, y, z, w] = access(props, def.value);\n                    gl.uniform4i(loc, x, y, z, w);\n                    break;\n                }\n                case \"4iv\":\n                    gl.uniform4iv(loc, access(props, def.value));\n                    break;\n                case \"4ui\": {\n                    const [x, y, z, w] = access(props, def.value);\n                    gl.uniform4ui(loc, x, y, z, w);\n                    break;\n                }\n                case \"4uiv\":\n                    gl.uniform4uiv(loc, access(props, def.value));\n                    break;\n                case \"matrix2fv\":\n                    gl.uniformMatrix2fv(loc, false, access(props, def.value));\n                    break;\n                case \"matrix3fv\":\n                    gl.uniformMatrix3fv(loc, false, access(props, def.value));\n                    break;\n                case \"matrix4fv\":\n                    gl.uniformMatrix4fv(loc, false, access(props, def.value));\n                    break;\n                case \"texture\":\n                    // TODO: is this the best way? (is it fast? can we cache?)\n                    const texture = access(props, def.value);\n                    const currentTexture = textureUnitOffset++;\n                    gl.activeTexture(gl.TEXTURE0 + currentTexture);\n                    gl.bindTexture(gl.TEXTURE_2D, texture.glTexture);\n                    gl.uniform1i(loc, currentTexture);\n                    break;\n                default:\n                    assert.never(def, `Unknown uniform type: (${ident})`);\n                    break;\n            }\n        });\n    }\n}\n\nfunction access<P, R>(props: P, value: ((props: P) => R) | R): R {\n    return typeof value === \"function\"\n        ? value(props)\n        : value;\n}\n\nclass UniformInfo<P> {\n    constructor(\n        readonly identifier: string,\n        readonly location: WebGLUniformLocation,\n        readonly definition: Uniform<P>,\n    ) { }\n}\n\nexport type AccessorOrValue<P, R> = Accessor<P, R> | R;\nexport type Accessor<P, R> = (props: P) => R;\n\n// TODO: support more WebGL2 uniforms: XxY matrices\n\nexport type Uniform<P> =\n    | Uniform1f<P> | Uniform1fv<P>\n    | Uniform1i<P> | Uniform1iv<P> | Uniform1ui<P> | Uniform1uiv<P>\n    | Uniform2f<P> | Uniform2fv<P>\n    | Uniform2i<P> | Uniform2iv<P> | Uniform2ui<P> | Uniform2uiv<P>\n    | Uniform3f<P> | Uniform3fv<P>\n    | Uniform3i<P> | Uniform3iv<P> | Uniform3ui<P> | Uniform3uiv<P>\n    | Uniform4f<P> | Uniform4fv<P>\n    | Uniform4i<P> | Uniform4iv<P> | Uniform4ui<P> | Uniform4uiv<P>\n    | UniformMatrix2fv<P> | UniformMatrix3fv<P> | UniformMatrix4fv<P>\n    | UniformTexture<P>\n    ;\n\nexport interface Uniform1f<P> {\n    type: \"1f\";\n    value: AccessorOrValue<P, number>;\n}\n\nexport interface Uniform1fv<P> {\n    type: \"1fv\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface Uniform1i<P> {\n    type: \"1i\";\n    value: AccessorOrValue<P, number>;\n}\n\nexport interface Uniform1iv<P> {\n    type: \"1iv\";\n    value: AccessorOrValue<P, Int32Array | number[]>;\n}\n\nexport interface Uniform1ui<P> {\n    type: \"1ui\";\n    value: AccessorOrValue<P, number>;\n}\n\nexport interface Uniform1uiv<P> {\n    type: \"1uiv\";\n    value: AccessorOrValue<P, Uint32Array | number[]>;\n}\n\nexport interface Uniform2f<P> {\n    type: \"2f\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface Uniform2fv<P> {\n    type: \"2fv\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface Uniform2i<P> {\n    type: \"2i\";\n    value: AccessorOrValue<P, Int32Array | number[]>;\n}\n\nexport interface Uniform2iv<P> {\n    type: \"2iv\";\n    value: AccessorOrValue<P, Int32Array | number[]>;\n}\n\nexport interface Uniform2ui<P> {\n    type: \"2ui\";\n    value: AccessorOrValue<P, Uint32Array | number[]>;\n}\n\nexport interface Uniform2uiv<P> {\n    type: \"2uiv\";\n    value: AccessorOrValue<P, Uint32Array | number[]>;\n}\n\nexport interface Uniform3f<P> {\n    type: \"3f\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface Uniform3fv<P> {\n    type: \"3fv\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface Uniform3i<P> {\n    type: \"3i\";\n    value: AccessorOrValue<P, Int32Array | number[]>;\n}\n\nexport interface Uniform3iv<P> {\n    type: \"3iv\";\n    value: AccessorOrValue<P, Int32Array | number[]>;\n}\n\nexport interface Uniform3ui<P> {\n    type: \"3ui\";\n    value: AccessorOrValue<P, Uint32Array | number[]>;\n}\n\nexport interface Uniform3uiv<P> {\n    type: \"3uiv\";\n    value: AccessorOrValue<P, Uint32Array | number[]>;\n}\n\nexport interface Uniform4f<P> {\n    type: \"4f\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface Uniform4fv<P> {\n    type: \"4fv\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface Uniform4i<P> {\n    type: \"4i\";\n    value: AccessorOrValue<P, Int32Array | number[]>;\n}\n\nexport interface Uniform4iv<P> {\n    type: \"4iv\";\n    value: AccessorOrValue<P, Int32Array | number[]>;\n}\n\nexport interface Uniform4ui<P> {\n    type: \"4ui\";\n    value: AccessorOrValue<P, Uint32Array | number[]>;\n}\n\nexport interface Uniform4uiv<P> {\n    type: \"4uiv\";\n    value: AccessorOrValue<P, Uint32Array | number[]>;\n}\n\nexport interface UniformMatrix2fv<P> {\n    type: \"matrix2fv\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface UniformMatrix3fv<P> {\n    type: \"matrix3fv\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface UniformMatrix4fv<P> {\n    type: \"matrix4fv\";\n    value: AccessorOrValue<P, Float32Array | number[]>;\n}\n\nexport interface UniformTexture<P> {\n    type: \"texture\";\n    value: AccessorOrValue<P, Texture>;\n}\n","import * as assert from \"./assert\";\nimport * as glutil from \"./glutil\";\n\nexport interface TextureOptions {\n    minFilter?: MinFilter;\n    magFilter?: MagFilter;\n    wrapS?: TextureWrap;\n    wrapT?: TextureWrap;\n    mipmap?: boolean;\n}\n\nexport const enum TextureWrap {\n    ClampToEdge,\n    Repeat,\n    MirroredRepeat,\n}\n\nexport const enum TextureFilter {\n    Nearest,\n    Linear,\n    NearestMipmapNearest,\n    LinearMipmapNearest,\n    NearestMipmapLinear,\n    LinearMipmapLinear,\n}\n\nexport type MinFilter = TextureFilter;\nexport type MagFilter = TextureFilter.Nearest | TextureFilter.Linear;\n\nexport const enum TextureInternalFormat {\n    // R\n    R8,\n    R8_SNORM,\n    R8UI,\n    R8I,\n    R16UI,\n    R16I,\n    R32UI,\n    R32I,\n    R16F,\n    R32F,\n\n    // RG\n    RG8,\n    RG8_SNORM,\n    RG8UI,\n    RG8I,\n    RG16UI,\n    RG16I,\n    RG32UI,\n    RG32I,\n    RG16F,\n    RG32F,\n\n    // RGB\n    RGB8,\n    RGB8_SNORM,\n    RGB8UI,\n    RGB8I,\n    RGB16UI,\n    RGB16I,\n    RGB32UI,\n    RGB32I,\n    RGB16F,\n    RGB32F,\n\n    // RGBA\n    RGBA8,\n    RGBA8_SNORM,\n    RGBA8UI,\n    RGBA8I,\n    RGBA16UI,\n    RGBA16I,\n    RGBA32UI,\n    RGBA32I,\n    RGBA16F,\n    RGBA32F,\n\n    // TODO: support exotic formats\n\n    // DEPTH\n    // DEPTH_COMPONENT16,\n    // DEPTH_COMPONENT24,\n    // DEPTH_COMPONENT32F,\n\n    // DEPTH STENCIL\n    // DEPTH24_STENCIL8,\n    // DEPTH32F_STENCIL8,\n\n    // LUMINANCE ALPHA\n    // LUMINANCE_ALPHA,\n    // LUMINANCE,\n    // ALPHA,\n}\n\nexport const enum TextureFormat {\n    RED,\n    RG,\n    RGB,\n    RGBA,\n    RED_INTEGER,\n    RG_INTEGER,\n    RGB_INTEGER,\n    RGBA_INTEGER,\n\n    // TODO: support exotic formats\n\n    // DEPTH_COMPONENT,\n    // DEPTH_STENCIL,\n    // LUMINANCE_ALPHA,\n    // LUMINANCE,\n    // ALPHA,\n}\n\nexport const enum TextureType {\n    UNSIGNED_BYTE,\n    UNSIGNED_SHORT,\n    UNSIGNED_INT,\n\n    BYTE,\n    SHORT,\n    INT,\n\n    FLOAT,\n\n    // TODO: support exotic formats\n    // HALF_FLOAT,\n\n    // UNSIGNED_SHORT_4_4_4_4,\n    // UNSIGNED_SHORT_5_5_5_1,\n    // UNSIGNED_SHORT_5_6_5,\n\n    // UNSIGNED_INT_24_8,\n    // UNSIGNED_INT_5_9_9_9_REV,\n    // UNSIGNED_INT_2_10_10_10_REV,\n    // UNSIGNED_INT_10F_11F_11F_REV,\n\n    // FLOAT_32_UNSIGNED_INT_24_8_REV,\n}\n\nexport class Texture {\n\n    static fromImage(\n        gl: WebGL2RenderingContext,\n        image: ImageData,\n        options?: TextureOptions,\n    ): Texture {\n        return Texture.RGBA8FromRGBAUint8Array(\n            gl,\n            image.data,\n            image.width,\n            image.height,\n            options,\n        );\n    }\n\n    static RGBA8FromRGBAUint8Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Uint8Array | Uint8ClampedArray | null,\n        width: number,\n        height: number,\n        options?: TextureOptions,\n    ): Texture {\n        return new Texture(\n            gl,\n            !data || data instanceof Uint8Array\n                ? data\n                // Note: we also have to convert Uint8ClampedArray to Uint8Array\n                // because of webgl bug\n                // https://github.com/KhronosGroup/WebGL/issues/1533\n                : new Uint8Array(data),\n            width,\n            height,\n            TextureInternalFormat.RGBA8,\n            TextureFormat.RGBA,\n            TextureType.UNSIGNED_BYTE,\n            options,\n        );\n    }\n\n    static RG16FFromRGFloat32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Float32Array | null,\n        width: number,\n        height: number,\n        options?: TextureOptions,\n    ): Texture {\n        return new Texture(\n            gl,\n            !data || data instanceof Float32Array\n                ? data\n                : new Float32Array(data),\n            width,\n            height,\n            TextureInternalFormat.RG16F,\n            TextureFormat.RG,\n            TextureType.FLOAT,\n            options,\n        );\n    }\n\n    static RGB16FFromRGBFloat32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Float32Array | null,\n        width: number,\n        height: number,\n        options?: TextureOptions,\n    ): Texture {\n        return new Texture(\n            gl,\n            !data || data instanceof Float32Array\n                ? data\n                : new Float32Array(data),\n            width,\n            height,\n            TextureInternalFormat.RGB16F,\n            TextureFormat.RGB,\n            TextureType.FLOAT,\n            options,\n        );\n    }\n\n    static RGBA16FFromRGBAFloat32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Float32Array | null,\n        width: number,\n        height: number,\n        options?: TextureOptions,\n    ): Texture {\n        return new Texture(\n            gl,\n            !data || data instanceof Float32Array\n                ? data\n                : new Float32Array(data),\n            width,\n            height,\n            TextureInternalFormat.RGBA16F,\n            TextureFormat.RGBA,\n            TextureType.FLOAT,\n            options,\n        );\n    }\n\n    static RGB32FFromRGBFloat32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Float32Array | null,\n        width: number,\n        height: number,\n        options?: TextureOptions,\n    ): Texture {\n        return new Texture(\n            gl,\n            !data || data instanceof Float32Array\n                ? data\n                : new Float32Array(data),\n            width,\n            height,\n            TextureInternalFormat.RGB32F,\n            TextureFormat.RGB,\n            TextureType.FLOAT,\n            options,\n        );\n    }\n\n    static RGBA32FFromRGBAFloat32Array(\n        gl: WebGL2RenderingContext,\n        data: number[] | Float32Array | null,\n        width: number,\n        height: number,\n        options?: TextureOptions,\n    ): Texture {\n        return new Texture(\n            gl,\n            !data || data instanceof Float32Array\n                ? data\n                : new Float32Array(data),\n            width,\n            height,\n            TextureInternalFormat.RGBA32F,\n            TextureFormat.RGBA,\n            TextureType.FLOAT,\n            options,\n        );\n    }\n\n    static fromArrayBufferView(\n        gl: WebGL2RenderingContext,\n        data: ArrayBufferView | null,\n        width: number,\n        height: number,\n        internalFormat: TextureInternalFormat,\n        format: TextureFormat,\n        type: TextureType,\n        options?: TextureOptions,\n    ): Texture {\n        return new Texture(\n            gl,\n            data,\n            width,\n            height,\n            internalFormat,\n            format,\n            type,\n            options,\n        );\n    }\n\n    readonly glTexture: WebGLTexture;\n    readonly width: number;\n    readonly height: number;\n    readonly internalFormat: TextureInternalFormat;\n\n    private constructor(\n        gl: WebGL2RenderingContext,\n        data: ArrayBufferView | null,\n        width: number,\n        height: number,\n        internalFormat: TextureInternalFormat,\n        format: TextureFormat,\n        type: TextureType,\n        {\n            minFilter = TextureFilter.Nearest,\n            magFilter = TextureFilter.Nearest,\n            wrapS = TextureWrap.ClampToEdge,\n            wrapT = TextureWrap.ClampToEdge,\n            mipmap = false,\n        }: TextureOptions = {},\n    ) {\n        this.glTexture = glutil.createTexture(\n            gl,\n            data,\n            width, height,\n            mapGlInternalFormat(gl, internalFormat),\n            mapGlFormat(gl, format),\n            mapGlType(gl, type),\n            mapGlWrap(gl, wrapS), mapGlWrap(gl, wrapT),\n            mapGlFilter(gl, minFilter), mapGlFilter(gl, magFilter),\n            mipmap,\n        );\n        this.width = width;\n        this.height = height;\n        this.internalFormat = internalFormat;\n    }\n}\n\nfunction mapGlWrap(gl: WebGL2RenderingContext, wrap: TextureWrap): number {\n    switch (wrap) {\n        case TextureWrap.ClampToEdge: return gl.CLAMP_TO_EDGE;\n        case TextureWrap.Repeat: return gl.REPEAT;\n        case TextureWrap.MirroredRepeat: return gl.MIRRORED_REPEAT;\n        default: return assert.never(wrap);\n    }\n}\n\nfunction mapGlFilter(gl: WebGL2RenderingContext, filter: TextureFilter): number {\n    switch (filter) {\n        case TextureFilter.Nearest: return gl.NEAREST;\n        case TextureFilter.Linear: return gl.LINEAR;\n        case TextureFilter.NearestMipmapNearest: return gl.NEAREST_MIPMAP_NEAREST;\n        case TextureFilter.LinearMipmapNearest: return gl.LINEAR_MIPMAP_NEAREST;\n        case TextureFilter.NearestMipmapLinear: return gl.NEAREST_MIPMAP_LINEAR;\n        case TextureFilter.LinearMipmapLinear: return gl.LINEAR_MIPMAP_LINEAR;\n        default: return assert.never(filter);\n    }\n}\n\nfunction mapGlInternalFormat(\n    gl: WebGL2RenderingContext,\n    internalFormat: TextureInternalFormat,\n): number {\n    switch (internalFormat) {\n        // R\n        case TextureInternalFormat.R8: return gl.R8;\n        case TextureInternalFormat.R8_SNORM: return gl.R8_SNORM;\n        case TextureInternalFormat.R8UI: return gl.R8UI;\n        case TextureInternalFormat.R8I: return gl.R8I;\n        case TextureInternalFormat.R16UI: return gl.R16UI;\n        case TextureInternalFormat.R16I: return gl.R16I;\n        case TextureInternalFormat.R32UI: return gl.R32UI;\n        case TextureInternalFormat.R32I: return gl.R32I;\n        case TextureInternalFormat.R16F: return gl.R16I;\n        case TextureInternalFormat.R32F: return gl.R32F;\n\n        // RG\n        case TextureInternalFormat.RG8: return gl.RG8;\n        case TextureInternalFormat.RG8_SNORM: return gl.RG8_SNORM;\n        case TextureInternalFormat.RG8UI: return gl.RG8UI;\n        case TextureInternalFormat.RG8I: return gl.RG8I;\n        case TextureInternalFormat.RG16UI: return gl.RG16UI;\n        case TextureInternalFormat.RG16I: return gl.RG16I;\n        case TextureInternalFormat.RG32UI: return gl.RG32UI;\n        case TextureInternalFormat.RG32I: return gl.RG32I;\n        case TextureInternalFormat.RG16F: return gl.RG16F;\n        case TextureInternalFormat.RG32F: return gl.RG32F;\n\n        // RGB\n        case TextureInternalFormat.RGB8: return gl.RGB8;\n        case TextureInternalFormat.RGB8_SNORM: return gl.RGB8_SNORM;\n        case TextureInternalFormat.RGB8UI: return gl.RGB8UI;\n        case TextureInternalFormat.RGB8I: return gl.RGB8I;\n        case TextureInternalFormat.RGB16UI: return gl.RGB16UI;\n        case TextureInternalFormat.RGB16I: return gl.RGB16I;\n        case TextureInternalFormat.RGB32UI: return gl.RGB32UI;\n        case TextureInternalFormat.RGB32I: return gl.RGB32I;\n        case TextureInternalFormat.RGB16F: return gl.RGB16F;\n        case TextureInternalFormat.RGB32F: return gl.RGB32F;\n\n        // RGBA\n        case TextureInternalFormat.RGBA8: return gl.RGBA8;\n        case TextureInternalFormat.RGBA8_SNORM: return gl.RGBA8_SNORM;\n        case TextureInternalFormat.RGBA8UI: return gl.RGBA8UI;\n        case TextureInternalFormat.RGBA8I: return gl.RGBA8I;\n        case TextureInternalFormat.RGBA16UI: return gl.RGBA16UI;\n        case TextureInternalFormat.RGBA16I: return gl.RGBA16I;\n        case TextureInternalFormat.RGBA32UI: return gl.RGBA32UI;\n        case TextureInternalFormat.RGBA32I: return gl.RGBA32I;\n        case TextureInternalFormat.RGBA16F: return gl.RGBA16F;\n        case TextureInternalFormat.RGBA32F: return gl.RGBA32F;\n        default: return assert.never(internalFormat);\n    }\n}\n\nfunction mapGlFormat(gl: WebGL2RenderingContext, format: TextureFormat): number {\n    switch (format) {\n        case TextureFormat.RED: return gl.RED;\n        case TextureFormat.RG: return gl.RG;\n        case TextureFormat.RGB: return gl.RGB;\n        case TextureFormat.RGBA: return gl.RGBA;\n        case TextureFormat.RED_INTEGER: return gl.RED_INTEGER;\n        case TextureFormat.RG_INTEGER: return gl.RG_INTEGER;\n        case TextureFormat.RGB_INTEGER: return gl.RGB_INTEGER;\n        case TextureFormat.RGBA_INTEGER: return gl.RGBA_INTEGER;\n        default: return assert.never(format);\n    }\n}\n\nfunction mapGlType(gl: WebGL2RenderingContext, type: TextureType): number {\n    switch (type) {\n        case TextureType.UNSIGNED_BYTE: return gl.UNSIGNED_BYTE;\n        case TextureType.UNSIGNED_SHORT: return gl.UNSIGNED_SHORT;\n        case TextureType.UNSIGNED_INT: return gl.UNSIGNED_INT;\n        case TextureType.BYTE: return gl.BYTE;\n        case TextureType.SHORT: return gl.SHORT;\n        case TextureType.INT: return gl.INT;\n        case TextureType.FLOAT: return gl.FLOAT;\n    }\n}\n","import * as glutil from \"./glutil\";\nimport { Texture } from \"./texture\";\n\nexport class Framebuffer {\n\n    static fromTextures(\n        gl: WebGL2RenderingContext,\n        textures: Texture[],\n    ): Framebuffer {\n        const fbo = glutil.createFramebuffer(gl, textures.map(t => t.glTexture));\n\n        const attachment = gl.COLOR_ATTACHMENT0;\n        return new Framebuffer(\n            gl,\n            fbo,\n            textures.map((_, i) => attachment + i),\n            textures[0].width, textures[0].height,\n        );\n    }\n\n    private constructor(\n        private gl: WebGL2RenderingContext,\n        readonly glFramebuffer: WebGLFramebuffer,\n        readonly colorAttachments: number[],\n        readonly width: number,\n        readonly height: number,\n    ) { }\n\n    bind(): void {\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.glFramebuffer);\n    }\n\n    unbind(): void {\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n    }\n}\n"],"names":["assert.never","glutil.createArrayBuffer","array.ravel","glutil.createElementArrayBuffer","INT_PATTERN","glutil.createVertexArray","array.is2DArray","glutil.createShader","glutil.createProgram","glutil.createTexture","glutil.createFramebuffer"],"mappings":"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"}